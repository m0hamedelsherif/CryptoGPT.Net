<div class="crypto-list-container">
  <div class="crypto-list-header">
    <h2>Cryptocurrencies</h2>
    <button class="refresh-button" [class.loading]="isLoading()" (click)="refreshData()" [disabled]="isLoading()">
      <i class="bi bi-arrow-clockwise"></i>
      <span>Refresh</span>
    </button>
  </div>

  <!-- Filter Bar -->
  <div class="filter-bar">
    <div class="filter-control">
      <i class="bi bi-search"></i>
      <input 
        type="text" 
        placeholder="Search by name or symbol..." 
        [value]="searchTerm()" 
        (input)="onSearch($event)"
        [disabled]="isLoading()">
    </div>
    <div class="sort-controls">
      <select [value]="sortBy()" (change)="onSortChange($event)" [disabled]="isLoading()">
        <option value="marketCapRank">Rank</option>
        <option value="name">Name</option>
        <option value="currentPrice">Price</option>
        <option value="priceChangePercentage24h">24h Change</option>
        <option value="marketCap">Market Cap</option>
        <option value="volume24h">Volume (24h)</option>
      </select>
      <select [value]="sortDirection()" (change)="onSortDirectionChange($event)" [disabled]="isLoading()">
        <option value="asc">Ascending</option>
        <option value="desc">Descending</option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading-overlay">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error() && !isLoading()" class="alert alert-danger" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    {{ error() }}
    <button class="btn btn-sm btn-outline-danger ms-3" (click)="refreshData()">Try Again</button>
  </div>

  <!-- Content Area -->
  <div *ngIf="!isLoading() && !error()">
    <div class="crypto-table" *ngIf="filteredCoins().length > 0">
      <div class="header">
        <div class="cell rank" (click)="setSortBy('marketCapRank')">
          #
          <i *ngIf="sortBy() === 'marketCapRank'" class="sort-indicator bi" 
            [ngClass]="sortDirection() === 'asc' ? 'bi-sort-numeric-down' : 'bi-sort-numeric-up'"></i>
        </div>
        <div class="cell coin" (click)="setSortBy('name')">
          Name
          <i *ngIf="sortBy() === 'name'" class="sort-indicator bi" 
            [ngClass]="sortDirection() === 'asc' ? 'bi-sort-alpha-down' : 'bi-sort-alpha-up'"></i>
        </div>
        <div class="cell price" (click)="setSortBy('currentPrice')">
          Price
          <i *ngIf="sortBy() === 'currentPrice'" class="sort-indicator bi" 
            [ngClass]="sortDirection() === 'asc' ? 'bi-sort-numeric-down' : 'bi-sort-numeric-up'"></i>
        </div>
        <div class="cell price-change" (click)="setSortBy('priceChangePercentage24h')">
          24h Change
          <i *ngIf="sortBy() === 'priceChangePercentage24h'" class="sort-indicator bi" 
            [ngClass]="sortDirection() === 'asc' ? 'bi-sort-numeric-down' : 'bi-sort-numeric-up'"></i>
        </div>
        <div class="cell market-cap" (click)="setSortBy('marketCap')">
          Market Cap
          <i *ngIf="sortBy() === 'marketCap'" class="sort-indicator bi" 
            [ngClass]="sortDirection() === 'asc' ? 'bi-sort-numeric-down' : 'bi-sort-numeric-up'"></i>
        </div>
        <div class="cell volume" (click)="setSortBy('volume24h')">
          Volume (24h)
          <i *ngIf="sortBy() === 'volume24h'" class="sort-indicator bi" 
            [ngClass]="sortDirection() === 'asc' ? 'bi-sort-numeric-down' : 'bi-sort-numeric-up'"></i>
        </div>
      </div>
      
      <div class="coin-row" *ngFor="let coin of paginatedCoins()" [routerLink]="['/coin', coin.id]">
        <div class="rank">{{ coin.marketCapRank || 'N/A' }}</div>
        <div class="coin">
          <img *ngIf="coin.image" [src]="coin.image" [alt]="coin.name" class="coin-image">
          <div class="coin-name-symbol">
            <span class="coin-name">{{ coin.name }}</span>
            <span class="coin-symbol">{{ coin.symbol }}</span>
          </div>
        </div>
        <div class="price">${{ coin.currentPrice | number:'1.2-6' }}</div>
        <div class="price-change" 
          [ngClass]="(coin.priceChangePercentage24h || 0) > 0 ? 'positive' : (coin.priceChangePercentage24h || 0) < 0 ? 'negative' : ''">
          <i class="bi" [ngClass]="(coin.priceChangePercentage24h || 0) > 0 ? 'bi-caret-up-fill' : (coin.priceChangePercentage24h || 0) < 0 ? 'bi-caret-down-fill' : ''"></i>
          {{ (coin.priceChangePercentage24h || 0) | number:'1.2-2' }}%
        </div>
        <div class="market-cap">${{ formatLargeNumber(coin.marketCap) }}</div>
        <div class="volume">${{ formatLargeNumber(coin.volume24h) }}</div>
      </div>
    </div>
    
    <!-- No Results -->
    <div *ngIf="filteredCoins().length === 0 && !isLoading()" class="no-results">
      <i class="bi bi-search"></i>
      <h4>No cryptocurrencies found</h4>
      <p>We couldn't find any cryptocurrencies matching your search criteria.</p>
      <button class="btn btn-outline-primary" (click)="resetFilters()">Clear Filters</button>
    </div>
    
    <!-- Pagination -->
    <nav *ngIf="filteredCoins().length > itemsPerPage" aria-label="Cryptocurrency pagination">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage() === 1">
          <a class="page-link" (click)="goToPage(currentPage() - 1)" aria-label="Previous" [class.disabled]="currentPage() === 1">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        <li class="page-item" *ngFor="let page of pageNumbers()" [class.active]="page === currentPage()">
          <a class="page-link" [class.active]="page === currentPage()" (click)="goToPage(page)">{{ page }}</a>
        </li>
        <li class="page-item" [class.disabled]="currentPage() === totalPages()">
          <a class="page-link" (click)="goToPage(currentPage() + 1)" aria-label="Next" [class.disabled]="currentPage() === totalPages()">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>